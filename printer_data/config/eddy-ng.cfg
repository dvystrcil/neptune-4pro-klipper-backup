
[mcu eddy]
serial: /dev/serial/by-id/usb-Klipper_rp2040_45474E621B0483CA-if00
restart_method: command
is_non_critical: True

[probe_eddy_ng btt_eddy]
sensor_type: btt_eddy
i2c_mcu: eddy
i2c_bus: i2c0f
x_offset: -53.36  #56.09
y_offset: -2 
write_every_tap_plot: true

[temperature_sensor btt_eddy_mcu]
sensor_type: temperature_mcu
sensor_mcu: eddy
min_temp: 10
max_temp: 100

[temperature_sensor btt_eddy]
sensor_type: Generic 3950
sensor_pin: eddy:gpio26

[gcode_macro CALIBRATE_EDDY]
gcode:
  M140 S60       ; start heating the bed
  FULL_HOME
  RESPOND PREFIX=calibrate_eddy MSG="Set initial nozzle temperature to prevent leakage (150C)"
  M109 S150      ; cool down
  RESPOND PREFIX=calibrate_eddy MSG="Waiting for bed to reach target of (60C)"
  M190 S60       ; heat bed to target, wait
  G4 S30         ; let the bed soak a little
  BRUSH          ; clean the brush, our temps are ready
  G28 Z
  G4 P0.2
  PROBE_EDDY_NG_SETUP

[gcode_macro CALIBRATE_EDDY_TEST]
variable_heights: "10,5,3,2,1"
gcode:
  {% set feed = 6000 %}
  M140 S60       ; start heating the bed
  RESPOND PREFIX=calibrate_eddy MSG="Set initial nozzle temperature to prevent leakage (150C)"
  M109 S150      ; cool down
  RESPOND PREFIX=calibrate_eddy MSG="Waiting for bed to reach target of (60C)"
  M190 S60       ; heat bed to target, wait
  G4 S30         ; let the bed soak a little
  BRUSH          ; clean the brush, our temps are ready
  G28 Z
  G90            ; absolute positioning
    {% set feed = 6000 %}
    {% set heights = heights.split(',') %}
    {% for h_str in heights %}
        {% set h = h_str|float %}
        G0 Z{h} F{feed}
        G4 P0.2
        PROBE_EDDY_NG_PROBE_STATIC
        RESPOND PREFIX=calibrate_eddy MSG="... {'%.2f' % (h-0.02)} ~ {'%.2f' % (h+0.02)} mm"
    {% endfor %}



